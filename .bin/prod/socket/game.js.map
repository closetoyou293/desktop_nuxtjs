{"version":3,"sources":["../../../server/socket/game.js"],"names":["Players","tickLengthMs","module","exports","io","on","client","id","postion","x","now","data","emit","previousTick","Date","gameLoop","setTimeout","setImmediate"],"mappings":";;AAAA,MAAMA,UAAU,EAAhB;AACA,MAAMC,eAAe,OAAO,EAA5B;;AAEAC,OAAOC,OAAP,GAAkBC,EAAD,IAAQ;AACrBA,OAAGC,EAAH,CAAM,SAAN,EAAkBC,MAAD,IAAY;AACzB;AACAA,eAAOD,EAAP,CAAU,WAAV,EAAuB,MAAK;AACxBL,oBAAQM,OAAOC,EAAf,IAAqB,EAArB;AACAP,oBAAQM,OAAOC,EAAf,EAAmBA,EAAnB,GAAwBD,OAAOC,EAA/B;AACAP,oBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,GAA6B;AAC7BC,mBAAG,EAD0B;AAE7BC,qBAAK;AAFwB,aAA7B;AAIH,SAPD;;AASA;AACAJ,eAAOD,EAAP,CAAU,YAAV,EAAyBM,IAAD,IAAS;AAC7B,gBAAG,CAACX,QAAQM,OAAOC,EAAf,CAAJ,EAAwB,OAAO,KAAP;;AAExB,gBAAGI,QAAQ,MAAX,EAAmB;AACnB,oBAAGX,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,IAAgC,CAAnC,EAAsC,OAAOT,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+B,CAAtC;AACtCT,wBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+BT,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+B,CAA9D;AACAT,wBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BE,GAA3B,GAAiC,MAAjC;AACA;AACC;AACD,gBAAGC,QAAQ,OAAX,EAAoB;AACpB,oBAAGX,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,IAAgC,GAAnC,EAAwC,OAAOT,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+B,GAAtC;AACxCT,wBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+BT,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BC,CAA3B,GAA+B,CAA9D;AACAT,wBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BE,GAA3B,GAAiC,OAAjC;AACA;AACC;AACD,gBAAGC,QAAQ,MAAX,EAAmB;AACnB,oBAAGX,QAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BE,GAA3B,IAAkC,MAArC,EAA6C,OAAO,KAAP;AAC7CV,wBAAQM,OAAOC,EAAf,EAAmBC,OAAnB,CAA2BE,GAA3B,GAAiC,MAAjC;AACA;AACC;AACJ,SApBD;;AAsBA;AACAJ,eAAOD,EAAP,CAAU,YAAV,EAAwB,MAAK;AACzB,mBAAOL,QAAQM,OAAOC,EAAf,CAAP;AACAH,eAAGQ,IAAH,CAAQ,YAAR,EAAsBN,OAAOC,EAA7B;AACH,SAHD;AAIH,KAvCD;;AAyCA,QAAIM,eAAeC,KAAKJ,GAAL,EAAnB;AACA,QAAIK,WAAW,YAAY;AACvB,YAAIL,MAAMI,KAAKJ,GAAL,EAAV;;AAEA,YAAIG,eAAeZ,YAAf,IAA+BS,GAAnC,EAAwC;AACpCG,2BAAeH,GAAf;;AAEA;AACAN,eAAGQ,IAAH,CAAQ,MAAR,EAAgBZ,OAAhB;AACH;;AAED,YAAIc,KAAKJ,GAAL,KAAaG,YAAb,GAA4BZ,eAAe,EAA/C,EAAmD;AAC/Ce,uBAAWD,QAAX;AACH,SAFD,MAEO;AACHE,yBAAaF,QAAb;AACH;AACJ,KAfD;AAgBAA;AACH,CA5DD","file":"game.js","sourcesContent":["const Players = {};\r\nconst tickLengthMs = 1000 / 60;\r\n\r\nmodule.exports = (io) => {\r\n    io.on('connect', (client) => {  \r\n        //New Player\r\n        client.on('NewPlayer', ()=> {\r\n            Players[client.id] = {};\r\n            Players[client.id].id = client.id;\r\n            Players[client.id].postion = {\r\n            x: 15,\r\n            now: 'turn'\r\n            }\r\n        });\r\n    \r\n        //Player Move\r\n        client.on('UpdateMove', (data)=> {\r\n            if(!Players[client.id]) return false;\r\n    \r\n            if(data == 'left') {\r\n            if(Players[client.id].postion.x <= 0) return Players[client.id].postion.x = 0;\r\n            Players[client.id].postion.x = Players[client.id].postion.x - 2;\r\n            Players[client.id].postion.now = 'left';\r\n            return \r\n            }\r\n            if(data == 'right') {\r\n            if(Players[client.id].postion.x >= 400) return Players[client.id].postion.x = 400;\r\n            Players[client.id].postion.x = Players[client.id].postion.x + 2;\r\n            Players[client.id].postion.now = 'right';\r\n            return \r\n            }\r\n            if(data == 'turn') {\r\n            if(Players[client.id].postion.now == 'turn') return false;\r\n            Players[client.id].postion.now = 'turn';\r\n            return \r\n            }\r\n        });\r\n    \r\n        //Player Disconnect\r\n        client.on('disconnect', ()=> {\r\n            delete Players[client.id];\r\n            io.emit('Disconnect', client.id);\r\n        });\r\n    });\r\n\r\n    let previousTick = Date.now();\r\n    let gameLoop = function () {\r\n        let now = Date.now()\r\n\r\n        if (previousTick + tickLengthMs <= now) {\r\n            previousTick = now;\r\n\r\n            //Logic\r\n            io.emit('Loop', Players);\r\n        }\r\n\r\n        if (Date.now() - previousTick < tickLengthMs - 16) {\r\n            setTimeout(gameLoop);\r\n        } else {\r\n            setImmediate(gameLoop);\r\n        }\r\n    };\r\n    gameLoop();\r\n};\r\n\r\n"]}